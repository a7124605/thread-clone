# Threads Clone 專案待辦清單 (todo.md)

本文件列出 Threads Clone 專案的所有開發任務，涵蓋資料庫設計、後端核心、前端基礎、進階功能及整合與優化。每個任務前面包含 `[]` 勾選框，用於追蹤進度。請在完成任務後標記為 `[x]`。

## 階段 1：資料庫設計

### 迭代 1.1：創建核心表
- [ ] **步驟 1.1.1**：創建 users 表（id、email、username、bio、password_hash、is_verified、role）。
- [ ] **步驟 1.1.2**：創建 posts 表（id、content、content_tsv、image_url、user_id、is_anonymous、is_deleted、likes_count、replies_count）。
- [ ] **步驟 1.1.3**：創建 replies 表（id、post_id、content、content_tsv、image_url、user_id、is_anonymous、is_deleted）。
- [ ] **步驟 1.1.4**：測試核心表結構（插入樣本資料，驗證約束）。

### 迭代 1.2：創建關聯表
- [ ] **步驟 1.2.1**：創建 likes 表（user_id、post_id）。
- [ ] **步驟 1.2.2**：創建 follows 表（follower_id、followed_id）。
- [ ] **步驟 1.2.3**：創建 verification_tokens 表（token、user_id、expires_at）。
- [ ] **步驟 1.2.4**：測試關聯表結構（驗證外鍵、級聯刪除）。

### 迭代 1.3：添加索引和全文搜尋
- [ ] **步驟 1.3.1**：為 posts.content 添加 tsvector 欄位和 GIN 索引。
- [ ] **步驟 1.3.2**：為 replies.content 添加 tsvector 欄位和 GIN 索引。
- [ ] **步驟 1.3.3**：添加其他索引（posts.user_id、replies.post_id 等）。
- [ ] **步驟 1.3.4**：測試索引（全文搜尋、查詢性能）。

### 迭代 1.4：配置 RLS
- [ ] **步驟 1.4.1**：為 users 表配置 RLS（個人資料、管理員查看）。
- [ ] **步驟 1.4.2**：為 posts 表配置 RLS（公開查看、認證創建）。
- [ ] **步驟 1.4.3**：為 replies 表配置 RLS（公開查看、認證創建）。
- [ ] **步驟 1.4.4**：為 likes 和 follows 表配置 RLS（用戶管理）。
- [ ] **步驟 1.4.5**：測試 RLS（模擬不同角色）。

## 階段 2：後端核心

### 迭代 2.1：設置 Spring Boot 專案
- [ ] **步驟 2.1.1**：初始化 Spring Boot 專案（pom.xml、依賴）。
- [ ] **步驟 2.1.2**：配置 Supabase 連線（JDBC、環境變數）。
- [ ] **步驟 2.1.3**：設置健康檢查控制器（GET /api/health）。
- [ ] **步驟 2.1.4**：測試專案設置（啟動、連線、健康檢查）。

### 迭代 2.2：實現註冊
- [ ] **步驟 2.2.1**：創建 User 實體和 UserRepository。
- [ ] **步驟 2.2.2**：實現註冊服務（bcrypt 雜湊、輸入驗證）。
- [ ] **步驟 2.2.3**：實現驗證 token 生成和儲存。
- [ ] **步驟 2.2.4**：實現註冊控制器（POST /api/register）。
- [ ] **步驟 2.2.5**：測試註冊功能（單元、整合）。

### 迭代 2.3：實現登入
- [ ] **步驟 2.3.1**：實現 JWT 生成服務。
- [ ] **步驟 2.3.2**：實現登入服務（密碼驗證）。
- [ ] **步驟 2.3.3**：實現登入控制器（POST /api/login）。
- [ ] **步驟 2.3.4**：配置 Spring Security（JWT 驗證）。
- [ ] **步驟 2.3.5**：測試登入功能（單元、整合）。

### 迭代 2.4：實現貼文創建
- [ ] **步驟 2.4.1**：創建 Post 實體和 PostRepository。
- [ ] **步驟 2.4.2**：實現貼文創建服務（內容驗證、匿名）。
- [ ] **步驟 2.4.3**：實現貼文控制器（POST /api/posts）。
- [ ] **步驟 2.4.4**：測試貼文創建（單元、整合）。

### 迭代 2.5：實現貼文刪除
- [ ] **步驟 2.5.1**：實現貼文刪除服務（軟刪除）。
- [ ] **步驟 2.5.2**：實現貼文刪除控制器（DELETE /api/posts/:post_id）。
- [ ] **步驟 2.5.3**：測試貼文刪除（單元、整合）。

### 迭代 2.6：實現點讚
- [ ] **步驟 2.6.1**：創建 Like 實體和 LikeRepository。
- [ ] **步驟 2.6.2**：實現點讚服務（單次點讚、計數更新）。
- [ ] **步驟 2.6.3**：實現點讚控制器（POST/DELETE /api/posts/:post_id/like）。
- [ ] **步驟 2.6.4**：測試點讚功能（單元、整合）。

### 迭代 2.7：實現回覆創建
- [ ] **步驟 2.7.1**：創建 Reply 實體和 ReplyRepository。
- [ ] **步驟 2.7.2**：實現回覆創建服務（內容驗證、匿名）。
- [ ] **步驟 2.7.3**：實現回覆控制器（POST /api/posts/:post_id/replies）。
- [ ] **步驟 2.7.4**：測試回覆創建（單元、整合）。

### 迭代 2.8：實現回覆刪除和排序
- [ ] **步驟 2.8.1**：實現回覆刪除服務（軟刪除）。
- [ ] **步驟 2.8.2**：實現回覆排序服務（順序/倒序）。
- [ ] **步驟 2.8.3**：實現回覆控制器（DELETE /api/replies/:reply_id、GET /api/posts/:post_id/replies）。
- [ ] **步驟 2.8.4**：測試回覆刪除和排序（單元、整合）。

### 迭代 2.9：生成 OpenAPI 文件
- [ ] **步驟 2.9.1**：配置 springdoc-openapi。
- [ ] **步驟 2.9.2**：為現有端點添加 OpenAPI 註解。
- [ ] **步驟 2.9.3**：測試 Swagger UI（/swagger-ui.html）。

## 階段 3：前端基礎

### 迭代 3.1：設置 React 專案
- [ ] **步驟 3.1.1**：初始化 React 專案（Vite）。
- [ ] **步驟 3.1.2**：配置 Tailwind CSS（深色模式）。
- [ ] **步驟 3.1.3**：設置路由（react-router-dom）。
- [ ] **步驟 3.1.4**：測試前端專案設置（渲染、樣式、路由）。

### 迭代 3.2：實現登入/註冊表單
- [ ] **步驟 3.2.1**：創建登入表單（電子郵件、密碼）。
- [ ] **步驟 3.2.2**：創建註冊表單（電子郵件、使用者名稱、密碼）。
- [ ] **步驟 3.2.3**：實現 API 連線（/api/register、/api/login）。
- [ ] **步驟 3.2.4**：測試登入/註冊表單（渲染、提交）。

### 迭代 3.3：實現時間軸
- [ ] **步驟 3.3.1**：創建貼文卡片組件（Markdown 渲染）。
- [ ] **步驟 3.3.2**：實現時間軸組件（無限滾動）。
- [ ] **步驟 3.3.3**：連線 API（GET /api/timeline）。
- [ ] **步驟 3.3.4**：測試時間軸（渲染、滾動）。

### 迭代 3.4：實現貼文表單
- [ ] **步驟 3.4.1**：創建貼文表單（內容、圖片 URL、匿名選項）。
- [ ] **步驟 3.4.2**：實現 API 連線（POST /api/posts）。
- [ ] **步驟 3.4.3**：實現點讚按鈕（POST/DELETE /api/posts/:post_id/like）。
- [ ] **步驟 3.4.4**：測試貼文表單（提交、點讚）。

### 迭代 3.5：實現回覆表單和排序
- [ ] **步驟 3.5.1**：創建回覆表單（內容、匿名選項）。
- [ ] **步驟 3.5.2**：實現回覆列表組件（排序下拉選單）。
- [ ] **步驟 3.5.3**：連線 API（POST /api/posts/:post_id/replies、GET /api/posts/:post_id/replies）。
- [ ] **步驟 3.5.4**：測試回覆功能（提交、排序）。

### 迭代 3.6：實現深色/淺色模式
- [ ] **步驟 3.6.1**：配置 Tailwind CSS 深色模式。
- [ ] **步驟 3.6.2**：實現主題切換按鈕（localStorage）。
- [ ] **步驟 3.6.3**：應用主題到現有組件。
- [ ] **步驟 3.6.4**：測試主題切換（視覺、持久化）。

### 迭代 3.7：實現行動裝置適配
- [ ] **步驟 3.7.1**：為貼文卡片添加響應式樣式。
- [ ] **步驟 3.7.2**：為表單和時間軸添加響應式樣式。
- [ ] **步驟 3.7.3**：測試響應式設計（不同設備尺寸）。

## 階段 4：進階功能

### 迭代 4.1：實現搜尋功能
- [ ] **步驟 4.1.1**：實現搜尋服務（tsvector 查詢）。
- [ ] **步驟 4.1.2**：實現搜尋控制器（GET /api/search）。
- [ ] **步驟 4.1.3**：創建前端搜尋欄和結果頁。
- [ ] **步驟 4.1.4**：測試搜尋功能（準確性、排序）。

### 迭代 4.2：實現追蹤/取消追蹤
- [ ] **步驟 4.2.1**：創建 Follow 實體和 FollowRepository。
- [ ] **步驟 4.2.2**：實現追蹤服務（防止自追蹤）。
- [ ] **步驟 4.2.3**：實現追蹤控制器（POST/DELETE /api/follow/:user_id）。
- [ ] **步驟 4.2.4**：實現前端追蹤按鈕。
- [ ] **步驟 4.2.5**：測試追蹤功能（單元、整合、前端）。

### 迭代 4.3：實現個人檔案頁
- [ ] **步驟 4.3.1**：實現個人檔案服務（貼文數、追蹤數）。
- [ ] **步驟 4.3.2**：實現個人檔案控制器（GET /api/users/:user_id）。
- [ ] **步驟 4.3.3**：創建前端個人檔案頁（貼文列表、追蹤按鈕）。
- [ ] **步驟 4.3.4**：測試個人檔案（渲染、數據）。

### 迭代 4.4：實現管理員功能
- [ ] **步驟 4.4.1**：實現管理員服務（匿名資訊、刪除）。
- [ ] **步驟 4.4.2**：實現管理員控制器（GET /api/admin/posts）。
- [ ] **步驟 4.4.3**：實現前端管理員按鈕（刪除）。
- [ ] **步驟 4.4.4**：測試管理員功能（權限、數據）。

## 階段 5：整合與優化

### 迭代 5.1：整合前端與後端
- [ ] **步驟 5.1.1**：配置前端 API 基礎 URL。
- [ ] **步驟 5.1.2**：測試所有 API 連線（認證、貼文、搜尋）。
- [ ] **步驟 5.1.3**：修復整合錯誤。

### 迭代 5.2：性能優化
- [ ] **步驟 5.2.1**：優化時間軸查詢（索引、快取）。
- [ ] **步驟 5.2.2**：優化搜尋查詢（限制結果數）。
- [ ] **步驟 5.2.3**：測試性能（響應時間）。

### 迭代 5.3：最終測試與錯誤修正
- [ ] **步驟 5.3.1**：執行全功能測試（手動、自動）。
- [ ] **步驟 5.3.2**：修復錯誤，更新文件。
- [ ] **步驟 5.3.3**：準備交付（GitHub 儲存庫）。

---

## 使用說明
- **進度追蹤**：完成任務後，將 `[]` 改為 `[x]`（例如 `[x] 創建 users 表`）。
- **儲存位置**：將本文件儲存於專案根目錄（/threads-clone/todo.md）。
- **更新頻率**：建議每完成一個迭代後提交至 GitHub，記錄進度。
- **參考文件**：參考 docs/specification.md 和 docs/database-schema.sql 確保任務符合規格。